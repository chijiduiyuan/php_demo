<!doctype html>
<html>
<head>
<meta charset="utf-8">
<title>确认订单</title>
<link rel="stylesheet" type="text/css" href="__PUBLIC__/Home/css/style.css" />
<link rel="stylesheet" type="text/css" href="__PUBLIC__/Home/css/shopping-mall-index.css" />
<script type="text/javascript" src="__PUBLIC__/Home/js/jquery.js"></script>
<script type="text/javascript" src="__PUBLIC__/Home/js/zhonglin.js"></script>
</head>

<body style="position:relative;">

	<include file="Include:top" />
    
    <!--切换城市-->
    <div class="switch-city w1200">
    	<a href="#" class="dianji-qh">切换城市</a>
        <span class="dqm">重庆市</span>
        <div class="select-city">
        	<div class="sl-city-top">
            	<p class="f-l">切换城市</p>
                <a class="close-select-city f-r" href="#">
                	<img src="__PUBLIC__/Home/images/close-select-city.gif" />
                </a>
            </div>
            <div class="sl-city-con">
            	<p>西北</p>
                <dl>
                	<dt>重庆市</dt>
                    <dd>
                    	<a href="#">长寿区</a>
                        <a href="#">巴南区</a>
                        <a href="#">南岸区</a>
                        <a href="#">九龙坡区</a>
                        <a href="#">沙坪坝区</a>
                        <a href="#">北碚</a>
                        <a href="#">江北区</a>
                        <a href="#">渝北区</a>
                        <a href="#">大渡口区</a>
                        <a href="#">渝中区</a>
                        <a href="#">万州</a>
                        <a href="#">武隆</a>
                        <a href="#">晏家</a>
                        <a href="#">长寿湖</a>
                        <a href="#">云集</a>
                        <a href="#">华中</a>
                        <a href="#">林封</a>
                        <a href="#">双龙</a>
                        <a href="#">石回</a>
                        <a href="#">龙凤呈祥</a>
                        <a href="#">朝天门</a>
                        <a href="#">中华</a>
                        <a href="#">玉溪</a>
                        <a href="#">云烟</a>
                        <a href="#">红塔山</a>
                        <a href="#">真龙</a>
                        <a href="#">天子</a>
                        <a href="#">娇子</a>
                    </dd>
                    <div style="clear:both;"></div>
                </dl>
                <dl>
                	<dt>新疆</dt>
                    <dd>
                    	<a href="#">齐乌鲁木</a>
                        <a href="#">昌吉</a>
                        <a href="#">巴音</a>
                        <a href="#">郭楞</a>
                        <a href="#">伊犁</a>
                        <a href="#">阿克苏</a>
                        <a href="#">喀什</a>
                        <a href="#">哈密</a>
                        <a href="#">克拉玛依</a>
                        <a href="#">博尔塔拉</a>
                        <a href="#">吐鲁番</a>
                        <a href="#">和田</a>
                        <a href="#">石河子</a>
                        <a href="#">克孜勒苏</a>
                        <a href="#">阿拉尔</a>
                        <a href="#">五家渠</a>
                        <a href="#">图木舒克</a>
                        <a href="#">库尔勒</a>
                    </dd>
                    <div style="clear:both;"></div>
                </dl>
                <dl>
                	<dt>甘肃</dt>
                    <dd>
                    	<a href="#">兰州</a>
                        <a href="#">天水</a>
                        <a href="#">巴音</a>
                        <a href="#">白银</a>
                        <a href="#">庆阳</a>
                        <a href="#">平凉</a>
                        <a href="#">酒泉</a>
                        <a href="#">张掖</a>
                        <a href="#">武威</a>
                        <a href="#">定西</a>
                        <a href="#">金昌</a>
                        <a href="#">陇南</a>
                        <a href="#">临夏</a>
                        <a href="#">嘉峪关</a>
                        <a href="#">甘南</a>
                    </dd>
                    <div style="clear:both;"></div>
                </dl>
                <dl>
                	<dt>宁夏</dt>
                    <dd>
                    	<a href="#">银川</a>
                        <a href="#">吴忠</a>
                        <a href="#">石嘴山</a>
                        <a href="#">中卫</a>
                        <a href="#">固原</a>
                    </dd>
                    <div style="clear:both;"></div>
                </dl>
                <dl>
                	<dt>青海</dt>
                    <dd>
                    	<a href="#">西宁</a>
                        <a href="#">海西</a>
                        <a href="#">海北</a>
                        <a href="#">果洛</a>
                        <a href="#">海东</a>
                        <a href="#">黄南</a>
                        <a href="#">玉树</a>
                        <a href="#">海南</a>
                    </dd>
                    <div style="clear:both;"></div>
                </dl>
            </div>
        </div>
    </div>
    
    <!--内容开始-->
    <div class="payment-interface w1200">
    	<div class="pay-info">
        	<div class="info-tit">
            	<h3>选择收货地址</h3>
            </div>
            <ul class="pay-dz">
           <!-- 地址循环输出    -->
            
              <volist name="address" id="avo">
              
                <if condition="$avo['tj'] eq 1">
                <php>$aa=$avo['id']</php>  
            	<li class="current" pid="{$avo.id}">
                <else />
                <li pid="{$avo.id}">
                </if>
                	<h3><span class="sp1">{$avo.pro}{$avo.city}</span><span class="sp2">{$avo.area}</span>（<span class="sp3">{$avo.name}</span> 收）</h3>
                    <p><span class="sp1">{$avo.address}</span><span class="sp2">{$avo.tel}</span></p>
                    <a href="JavaScript:;" xiugai="">修改</a>
                </li>
                
               </volist>
               
               <!--  地址循环输出结束  -->
               
               

                <div style="clear:both;"></div>
            </ul>
            <P class="pay-xgdz">修改地址和使用新地址样式一样。</P>
            <button class="pay-xdz-btn">使用新地址</button>
        </div>
        <div class="pay-info">
        	<div class="info-tit" style="border-bottom:0;">
            	<h3>订单信息</h3>
            </div>
        </div>
        <form method="post" action="{:U('Car/order')}">
            <!-- 存放地址id  -->
            <input type="hidden" id="uid" name="id" value="{$aa}" />
            <!-- 总价 -->
            <input type="hidden"  name="totals" value="{$totals}" />
            <input type="hidden" name="TOKEN" value="{:session('TOKEN')}"> 
        <div class="cart-con-info">
        	<div class="cart-con-tit" style="margin:20px 0 5px;">
                <p class="p1" style="width:200px;">
                   产品图片
                </p>
                <p class="p3" style="width:145px; margin-left:60px;">产品名称</p>
                <p class="p4" style="width:130px; margin-left:130px">数量</p>
                <p class="p5">单价（元）</p>
                <p class="p6" style="width:173px;">金额（元）</p>
                <p class="p7">&nbsp;</p>
            </div>
            
            
           
            <div class="addr">
          <!--  循环订单信息 -->  
         <volist name="cplist" id="cpvo">
            <div class="info-mid">
                <div class="mid-tu f-l">
                	<a href="#"><img src="__ROOT__/Uploads/{$cpvo.spic}" width="80" height="80" /></a>
                </div>
                <div class="mid-font f-l" style="margin:20px 0 0 120px; width:180px">
                	<a href="#">{$cpvo.cpname}
                </div>
     
              <div class="mid-sl f-l" style="margin:30px 54px 0px 126px;">
                <input type="text" value="{$cpvo.num}" readonly/>
                <input type="hidden" value="{$cpvo.cpid}" name="cpid[]" />
                
                </div>
                
              <p class="mid-dj f-l" style="margin:30px 0 0 40px;">¥ {$cpvo.price}</p>
                <p class="mid-je f-l" style="margin:30px 0 0px 116px;">¥ {$cpvo['num']*$cpvo['price']}</p>
                <div class="mid-chaozuo f-l"></div>
                <div style="clear:both;"></div>
            </div>
             </volist>
           
         <!-- 循环结束 -->
            </div>
            
            
            
            
            
            <div class="info-tijiao">
           	  <p class="p1">实付款：<span id>¥{$totals}</span></p>
                <button class="btn">提交订单</button>
            </div>
        </div>
        </form>
    </div>
    
 <include file="Include:footer" />

    <!--确认订单（新增地址）-->

    <div class="confirmation-tanchuang" id="new_addr" xgdz1="">
    	<div class="tanchuang-bg"></div>
    	<div class="tanchuang-con">
        	<div class="tc-title">
            	<h3>新增地址</h3>
                <a href="JavaScript:;" dz-guan=""><img src="__PUBLIC__/Home/images/close-select-city.gif" /></a>
                <div style="clear:both;"></div>
            </div>
            <ul class="tc-con2">
            	<li class="tc-li1">
                	<p class="l-p">所在地区<span>*</span></p>
                    <div class="xl-dz">
                    	<div class="dz-left f-l">
                              <select  id="proId" name="pro">
                              
                              </select>
                              <select  id="cityId" name="city">
                             </select>   
                              <select  id="areaId" name="area">
                             </select>  
                        </div>
                      
                    	<div style="clear:both;"></div>
                    </div>
                    <div style="clear:both;"></div>
                </li>
            	<li class="tc-li1">
                	<p class="l-p">详细地址<span>*</span></p>
                    <textarea class="textarea1" id="addr" placeholder="请如实填写您的详细信息，如街道名称、门牌号、楼层号和房间号。" name="address"></textarea>
                    <div style="clear:both;"></div>
                </li>
            	<li class="tc-li1">
                	<p class="l-p">邮政编码<span></span></p>
                    <input type="text" name="post" id="post" />
                    <div style="clear:both;"></div>
                </li>
            	<li class="tc-li1">
                	<p class="l-p">收货人姓名<span>*</span></p>
                    <input type="text" name="name" id="name" />
                    <div style="clear:both;"></div>
                </li>
            	<li class="tc-li1">
                	<p class="l-p">联系电话<span>*</span></p>
                    <input type="text" name="tel" id="tel" />
                    <div style="clear:both;"></div>
                </li>
            </ul>
            <button class="btn-pst2">保存</button>
        </div>
    </div>
    
<script>


//省市区 
   ajax($("#proId"),100000); //第一次加载页面要把所有省调出来
   
   //省的变化事件
   $("#proId").change(function(){
	    $("#areaId").html(""); //清空区的内容
	     var class_id=$(this).val();
		
		 ajax($("#cityId"),class_id);
	   });
	   
	//市的变化   
	$("#cityId").change(function(){
		var class_id=$(this).val();
		ajax($("#areaId"),class_id);
		});
	   
   
   function ajax(e,id){
	       $.ajax({
			     url:"{:U('Car/ajax_city')}",
				 type:"POST",
				 async:true,
				 dataType:"json",
				 data:{'id':id},
				 success:function(data){
					  var ss="<option>---请选择---</option>";
					   for(var i in data){
						     // alert(data[i].class_name);
							 ss+="<option value="+data[i].class_id+">"+data[i].class_name+"</option>"; 
						   }
						  e.html(ss);	   
					 },

			   });
	   
	   }
   


//新地址提交
 $(".btn-pst2").click(function(){
	      $("#new_addr").hide(); //一点保存就关闭地址输入框
		  var pro=$("#proId").val();
		  var city=$("#cityId").val();
		  var area=$("#areaId").val();
		  var address=$("#addr").val();
		  var post=$("#post").val();
		  var name=$("#name").val();
		  var tel=$("#tel").val();
		  
		  $.ajax({
			    url:"{:U('Car/ajax_addr')}",
				type:'POST',
				async:true,
				dataType:"json",
				data:{'pro':pro,'city':city,'area':area,'address':address,'post':post,'name':name,'tel':tel},
				success:function(data){	
                     $(".pay-dz li").removeClass('current'); //在增加之前其它的地址current去掉
					 var html='<li class="current" pid="'+data.id+'"><h3><span class="sp1">'+data.pro+data.city+'</span><span class="sp2">'+data.area+'</span>(<span class="sp3">'+data.name+'</span> 收)</h3><p><span class="sp1">'+data.address+'</span><span class="sp2">'+data.tel+'</span></p><a href="JavaScript:;" xiugai="">修改</a></li>';
					 $(".pay-dz").prepend(html);
					 $("#uid").val(data.id);  //改变地址的ID
					},
			   
			  }); 

	 });



	/*确认订单 地址切换*/
	$(".pay-dz li").click(function(event) {
		$(this).addClass('current').siblings().removeClass("current");
		var ss=$(this).attr('pid');
		$("#uid").val(ss);  //改变地址的ID
		//alert(ss);
	});
</script>
</body>
</html>
